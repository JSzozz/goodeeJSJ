<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org/DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="employee">
<!--   <cache-ref namespace="employee"/> -->

	
  <resultMap type="emp" id="employeeMap">
  	<id property="empId" column="EMP_ID"/>
  	<result property="empName" column="EMP_NAME"/>
  	<result property="empNo" column="EMP_NO"/>
  	<result property="email" column="EMAIL"/>
  	<result property="phone" column="PHONE"/>
  	<!-- <result property="deptCode" column="DEPT_CODE"/> -->
  	<result property="jobCode" column="JOB_CODE"/>
  	<result property="salLevel" column="SAL_LEVEL"/>
  	<result property="salary" column="SALARY"/>
  	<result property="bonus" column="BONUS"/>
  	<result property="managerId" column="MANAGER_ID"/>
  	<result property="hireDate" column="HIRE_DATE"/>
  	<result property="entDate" column="ENT_DATE"/>
  	<result property="entYn" column="ENT_YN"/>
	<result property="email" column="email"/>
	<result property="phone" column="phone"/>
	<result property="bonus" column="bonus"/>
	<result property="salary" column="salary"/>
  	<association property="dept" resultMap="departmentMap"></association><!-- V -->
  </resultMap>
  <!-- (유의)association, collection이 들어가는 순간 (DB컬럼명과 필드 변수명이 같은 경우) 
  		자동 매칭되던 부분이 매칭이 안되게됨 따라서 빼먹는 부분 없이 모두 작성이 필요함 -->
  		
  <resultMap id="departmentMap" type="department" ><!-- id : Alias -->
  	<id property="deptId" column="DEPT_ID"/>
  	<result property="deptTitle" column="DEPT_TITLE"/>
  	<result property="locationId" column="LOCATION_ID"/>
  	<!-- 1:n 관계일 때 -->
  	<collection property="employees" resultMap="employeeMap" />
  </resultMap>
  
  <select id="selectAllDept" resultMap="departmentMap">
  	SELECT * FROM DEPARTMENT LEFT JOIN EMPLOYEE ON DEPT_CODE=DEPT_ID
  </select>
  
  <select id="selectEmployeeAll" resultMap="employeeMap">
  	SELECT * FROM EMPLOYEE JOIN DEPARTMENT ON DEPT_CODE=DEPT_ID  
  </select>
  
  <select id="selectStudentCount" resultType="_int">
  	SELECT COUNT(*) FROM EMPLOYEE
  </select>
  
  <select id="selectEmployeePage" resultMap="employeeMap">
  	SELECT * FROM EMPLOYEE JOIN DEPARTMENT ON DEPT_CODE=DEPT_ID  
  </select>
  
	<!--  
		파라미터값을 가져올때 
		#{} : setType()값을 대입 -> 자료형에 맞는 리터럴을 대입 ->'emp_id'
		${} : 문자열처리하는 표현 -> emp_id
	-->
  <select id="searchEmp"  parameterType="map" resultMap="employeeMap">
  	<!-- SELECT *
	FROM
		(SELECT E.*,
			DECODE(SUBSTR(EMP_NO,8,1),'1','M','2','F','3','M','4','F') 
			AS GENDER 
			FROM EMPLOYEE e)
	WHERE GENDER=#{gender}
	AND WHERE ${type} LIKE '%'||#{keyword}||'%'   -->
	 SELECT * 
	 FROM 
	 	(SELECT E.*, 
	 	DECODE(SUBSTR(EMP_NO,8,1),'1','M','2','F','3','M','4','F') AS GENDER 
	 	FROM EMPLOYEE E)
	 WHERE 1=1 
	 <!-- WHERE -->
	 <!-- <trim prefix="WHERE" prefixOverrides="AND|OR"> -->
		 <if test=" keyword!=null and keyword!='' ">
		 	AND ${type} LIKE '%'||#{keyword}||'%' 
	 	</if>
	 	<if test=" gender!=null and gender!='' ">
	 		AND GENDER = #{gender}
		 </if>
		<if test="salFlag!=null and salary!=null and salary!='' ">
		 	<!-- <if test=" salFlag =='le' ">le=이상
		 		AND SALARY >= #{salary}
			 </if>		 
		 	<if test=" salFlag == 'ge' ">ge=이하
		 		<![CDATA[
		 		AND SALARY <= #{salary}
		 		]]> 
			 </if>	 -->
			<choose>
				<when test="salFlag == 'le'">
					<![CDATA[
					AND SALARY <= #{salary}
					]]>  
				</when>
				<otherwise> 
					AND SALARY >= #{salary} 
				</otherwise>
			</choose>
		 </if>
		
		<if test="deptCodes !=null and deptCodes!='' ">
			AND DEPT_CODE IN 
			<!--  
				foreach문을 사용할 수 있다
				속성
				collection : 배열방식의 데이터
				item : 배열의 데이터를 저장하는 변수명
				open : 반복을 시작할때 출력할 값을 설정
				close : 반복을 끝냈을때 출력할 값을 설정
				separator : 반복할때마다 출력할 값을 설정
				index : 배열의 인덱스번호를 저장하는 변수
			 -->
			<foreach item="d" collection="deptCodes" open="(" separator="," close=")">
				#{d}
			</foreach>
		</if>
		<if test="jobCodes !=null and jobCodes!='' ">
			AND JOB_CODE IN 
			<foreach item="j" collection="jobCodes" open="(" separator="," close=")">
				#{j}
			</foreach>
		</if>
		<if test=" searchStartDate!=null and searchStartDate!=''
				and searchEndDate!=null and searchEndDate!='' ">
		 	AND HIRE_DATE BETWEEN #{searchStartDate} AND #{searchEndDate}
	 	</if>
		 
	<!-- </WHERE> -->
	<!-- </trim>  -->
  </select>
  
  
</mapper>
